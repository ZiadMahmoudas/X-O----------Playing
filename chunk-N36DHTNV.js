import{h as Z}from"./chunk-IRDK2I2U.js";import{a as X}from"./chunk-2DFS2U5V.js";import{a as B,c as q,d as Q,f as W,h as G,i as Y,l as $,m as H,n as J,p as K}from"./chunk-2GGCCMO2.js";import{a as j}from"./chunk-G5KA7DMQ.js";import{c as R}from"./chunk-D3ZEN3NJ.js";import{$ as p,Aa as O,Ea as _,G as h,Jb as V,Pb as T,Qb as z,Sb as L,Ta as l,Ua as n,Va as r,Wa as c,a as S,aa as g,ab as C,b as A,cb as m,eb as x,ga as b,gb as U,hb as F,ib as N,lb as I,nb as M,pa as w,pb as a,qb as P,ra as s,rb as y,sb as E,tb as k,ub as D,va as v}from"./chunk-22QBDJS3.js";var te=["fileInputRef"];function ie(u,i){u&1&&(n(0,"div",31),c(1,"i",32),n(2,"p"),a(3,"\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0635\u0648\u0631..."),r()())}function ne(u,i){if(u&1){let e=C();n(0,"button",40),m("click",function(){p(e);let o=x().$implicit,f=x(2);return g(f.setAsProfileImage(o.id))}),c(1,"i",14),r()}if(u&2){let e=x(3);l("disabled",e.isSettingActive()),s(),M("fa-star",!e.isSettingActive())("fa-spinner",e.isSettingActive())("fa-spin",e.isSettingActive())}}function re(u,i){u&1&&(n(0,"div",41),c(1,"i",42),a(2," \u0646\u0634\u0637\u0629 "),r())}function oe(u,i){if(u&1){let e=C();n(0,"div",35)(1,"div",36),_(2,ne,2,7,"button",37),r(),n(3,"img",38),m("error",function(o){return p(e),g(o.target.src="https://res.cloudinary.com/dsqtrbbmw/image/upload/v1760612462/user_ei8llz.jpg")}),r(),_(4,re,3,0,"div",39),r()}if(u&2){let e=i.$implicit;s(2),l("ngIf",!e.isActive),s(),l("src",e.imageUrl,w),s(),l("ngIf",e.isActive)}}function se(u,i){if(u&1&&(n(0,"div",33),_(1,oe,5,3,"div",34),r()),u&2){let e=x();s(),l("ngForOf",e.currentImages)}}function ae(u,i){u&1&&(n(0,"div",43),c(1,"i",44),n(2,"p"),a(3,"\u0644\u0627 \u064A\u0648\u062C\u062F \u0635\u0648\u0631 \u0641\u064A \u0627\u0644\u0623\u0644\u0628\u0648\u0645"),r(),n(4,"small"),a(5,"\u0642\u0645 \u0628\u0631\u0641\u0639 \u0635\u0648\u0631\u062A\u0643 \u0627\u0644\u0623\u0648\u0644\u0649 \u0627\u0644\u0622\u0646!"),r()())}var ee=class u{constructor(i,e,t,o){this.userService=i;this.auth=e;this.toastr=t;this.cdr=o}fileInputRef;userId=0;currentUserName="";newUserName="";isSaving=b(!1);isUploading=b(!1);isLoadingImages=b(!1);isSettingActive=b(!1);selectedFile=null;selectedFileName="\u0644\u0645 \u064A\u062A\u0645 \u0627\u062E\u062A\u064A\u0627\u0631 \u0635\u0648\u0631\u0629";currentImages=[];subscriptions=[];ngOnInit(){console.log("\u{1F680} MyProfile Component initialized"),this.userId=this.getUserId(),console.log("\u{1F464} User ID:",this.userId),this.userId>0?(this.loadUserProfile(),this.loadUserImages()):(console.error("\u274C Invalid user ID"),this.toastr.error("\u062E\u0637\u0623 \u0641\u064A \u062A\u062D\u062F\u064A\u062F \u0647\u0648\u064A\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645"))}ngOnDestroy(){console.log("\u{1F534} MyProfile Component destroyed - cleaning up"),this.subscriptions.forEach(i=>i.unsubscribe()),this.subscriptions=[]}getUserId(){let i=this.auth.getAccessToken();if(!i)return console.warn("\u26A0\uFE0F No access token"),0;try{let e=j(i),t=e.sub||e.userId||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];return t&&parseInt(t)||0}catch(e){return console.error("\u274C Error decoding token:",e),0}}loadUserProfile(){console.log("\u{1F504} Loading user profile...");let i=this.userService.getCurrentUserById(this.userId).subscribe({next:e=>{let t=e.data||e;this.currentUserName=t.userName||"",this.newUserName=t.userName||"",console.log("\u2705 Username loaded:",this.currentUserName),this.cdr.detectChanges()},error:e=>{console.error("\u274C Error loading profile:",e),this.toastr.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A")}});this.subscriptions.push(i)}loadUserImages(){console.log("\u{1F504} Loading user images..."),this.isLoadingImages.set(!0);let i=this.userService.GetAllImageForUser().pipe(h(()=>{this.isLoadingImages.set(!1),this.cdr.detectChanges()})).subscribe({next:e=>{e&&e.success&&Array.isArray(e.data)?(this.currentImages=e.data,console.log(`\u2705 Loaded ${this.currentImages.length} images`)):(this.currentImages=[],console.warn("\u26A0\uFE0F No images found")),this.cdr.detectChanges()},error:e=>{console.error("\u274C Error loading images:",e),this.toastr.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0635\u0648\u0631"),this.currentImages=[]}});this.subscriptions.push(i)}saveChanges(i){if(!i.valid||this.newUserName===this.currentUserName)return;this.isSaving.set(!0),console.log("\u{1F504} Updating username to:",this.newUserName);let e=this.userService.updateNameUser(this.userId,this.newUserName).pipe(h(()=>{this.isSaving.set(!1),this.cdr.detectChanges()})).subscribe({next:()=>{this.currentUserName=this.newUserName,this.toastr.success("\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0627\u0633\u0645 \u0628\u0646\u062C\u0627\u062D"),console.log("\u2705 Username updated successfully"),this.cdr.detectChanges()},error:t=>{console.error("\u274C Update failed:",t),t.status===415?this.toastr.error("\u062E\u0637\u0623 \u0641\u064A \u0646\u0648\u0639 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0631\u0633\u0644\u0629"):this.toastr.error("\u0641\u0634\u0644 \u0627\u0644\u062A\u062D\u062F\u064A\u062B")}});this.subscriptions.push(e)}setAsProfileImage(i){console.log("\u2B50 Setting image as profile:",i);let e=[...this.currentImages];this.isSettingActive.set(!0),this.currentImages=this.currentImages.map(o=>A(S({},o),{isActive:o.id===i})),this.cdr.detectChanges();let t=this.userService.setActiveImage(i).pipe(h(()=>{this.isSettingActive.set(!1),this.cdr.detectChanges()})).subscribe({next:o=>{this.toastr.success("\u062A\u0645 \u062A\u0639\u064A\u064A\u0646 \u0627\u0644\u0635\u0648\u0631\u0629 \u0643\u0635\u0648\u0631\u0629 \u0631\u0626\u064A\u0633\u064A\u0629 \u0628\u0646\u062C\u0627\u062D"),this.loadUserProfile()},error:o=>{console.error("\u274C Failed to set active image:",o),this.toastr.error("\u0641\u0634\u0644 \u062A\u0639\u064A\u064A\u0646 \u0627\u0644\u0635\u0648\u0631\u0629 \u0643\u0635\u0648\u0631\u0629 \u0631\u0626\u064A\u0633\u064A\u0629"),this.currentImages=e,this.cdr.detectChanges()}});this.subscriptions.push(t)}onFileSelected(i){let e=i.target.files[0];if(!e){this.resetFileSelection();return}if(console.log("\u{1F4C1} File selected:",e.name),!e.type.startsWith("image/")){this.toastr.error("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0635\u0648\u0631\u0629 \u0641\u0642\u0637"),this.resetFileSelection();return}if(e.size>5*1024*1024){this.toastr.error("\u062D\u062C\u0645 \u0627\u0644\u0635\u0648\u0631\u0629 \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0623\u0642\u0644 \u0645\u0646 5MB"),this.resetFileSelection();return}this.selectedFile=e,this.selectedFileName=e.name}uploadFile(){if(!this.selectedFile){this.toastr.warning("\u0627\u0644\u0631\u062C\u0627\u0621 \u0627\u062E\u062A\u064A\u0627\u0631 \u0635\u0648\u0631\u0629 \u0623\u0648\u0644\u0627\u064B");return}console.log("\u{1F4E4} Uploading file:",this.selectedFile.name),this.isUploading.set(!0);let i=new FormData;i.append("File",this.selectedFile);let e=this.userService.uploadImageUser(i).pipe(h(()=>{this.isUploading.set(!1),this.cdr.detectChanges()})).subscribe({next:t=>{console.log("\u2705 Upload success:",t),this.toastr.success("\u062A\u0645 \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629 \u0628\u0646\u062C\u0627\u062D"),this.resetFileSelection(),this.loadUserImages()},error:t=>{console.error("\u274C Upload failed:",t),t.status===413?this.toastr.error("\u062D\u062C\u0645 \u0627\u0644\u0635\u0648\u0631\u0629 \u0643\u0628\u064A\u0631 \u062C\u062F\u0627\u064B"):t.status===415?this.toastr.error("\u0646\u0648\u0639 \u0627\u0644\u0645\u0644\u0641 \u063A\u064A\u0631 \u0645\u062F\u0639\u0648\u0645"):this.toastr.error("\u0641\u0634\u0644 \u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629")}});this.subscriptions.push(e)}resetFileSelection(){this.selectedFile=null,this.selectedFileName="\u0644\u0645 \u064A\u062A\u0645 \u0627\u062E\u062A\u064A\u0627\u0631 \u0635\u0648\u0631\u0629",this.fileInputRef&&(this.fileInputRef.nativeElement.value="")}static \u0275fac=function(e){return new(e||u)(v(X),v(R),v(Z),v(V))};static \u0275cmp=O({type:u,selectors:[["app-myprofile"]],viewQuery:function(e,t){if(e&1&&U(te,5),e&2){let o;F(o=N())&&(t.fileInputRef=o.first)}},decls:47,vars:23,consts:[["userForm","ngForm"],["fileInputRef",""],[1,"profile-edit-container"],[1,"edit-title"],[1,"edit-subtitle"],[1,"card-section","user-info-card"],[1,"card-title"],[1,"fas","fa-user"],[3,"ngSubmit"],[1,"form-group"],["for","userNameInput",1,"form-label"],["type","text","id","userNameInput","name","userName","required","","minlength","3","maxlength","30","placeholder","\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0627\u0644\u062C\u062F\u064A\u062F",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-hint"],["type","submit",1,"btn-save",3,"disabled"],[1,"fas"],[1,"card-section","photo-management-card"],[1,"fas","fa-camera"],[1,"card-text"],[1,"file-upload-section"],[1,"file-upload-area"],["for","fileInput",1,"custom-file-upload"],[1,"fas","fa-cloud-upload-alt"],["type","file","accept","image/*","id","fileInput",2,"display","none",3,"change"],[1,"file-name"],[1,"btn-upload",3,"click","disabled"],[1,"card-section","current-photos-card"],[1,"fas","fa-images"],[1,"badge"],["class","loading-images",4,"ngIf"],["class","photos-grid",4,"ngIf"],["class","no-photos",4,"ngIf"],[1,"loading-images"],[1,"fas","fa-spinner","fa-spin"],[1,"photos-grid"],["class","photo-item",4,"ngFor","ngForOf"],[1,"photo-item"],[1,"photo-actions"],["class","btn-set-main","title","\u062A\u0639\u064A\u064A\u0646 \u0643\u0635\u0648\u0631\u0629 \u0631\u0626\u064A\u0633\u064A\u0629",3,"disabled","click",4,"ngIf"],["alt","\u0635\u0648\u0631\u0629 \u0627\u0644\u0623\u0644\u0628\u0648\u0645",1,"album-img",3,"error","src"],["class","active-badge",4,"ngIf"],["title","\u062A\u0639\u064A\u064A\u0646 \u0643\u0635\u0648\u0631\u0629 \u0631\u0626\u064A\u0633\u064A\u0629",1,"btn-set-main",3,"click","disabled"],[1,"active-badge"],[1,"fas","fa-check-circle"],[1,"no-photos"],[1,"fas","fa-image","fa-3x"]],template:function(e,t){if(e&1){let o=C();n(0,"div",2)(1,"h3",3),a(2,"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A"),r(),n(3,"p",4),a(4,"\u0642\u0645 \u0628\u062A\u062D\u062F\u064A\u062B \u0645\u0639\u0644\u0648\u0645\u0627\u062A\u0643 \u0627\u0644\u0634\u062E\u0635\u064A\u0629 \u0648\u0627\u0644\u0635\u0648\u0631."),r(),n(5,"div",5)(6,"h4",6),c(7,"i",7),a(8," \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 "),r(),n(9,"form",8,0),m("ngSubmit",function(){p(o);let d=I(10);return g(t.saveChanges(d))}),n(11,"div",9)(12,"label",10),a(13,"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u062C\u062F\u064A\u062F:"),r(),n(14,"input",11),D("ngModelChange",function(d){return p(o),k(t.newUserName,d)||(t.newUserName=d),g(d)}),r(),n(15,"small",12),a(16),r()(),n(17,"button",13),c(18,"i",14),a(19),r()()(),n(20,"div",15)(21,"h4",6),c(22,"i",16),a(23," \u0625\u0636\u0627\u0641\u0629 \u0635\u0648\u0631\u0629 \u062C\u062F\u064A\u062F\u0629 "),r(),n(24,"p",17),a(25,"\u0627\u062E\u062A\u0631 \u0635\u0648\u0631\u0629 \u0644\u0625\u0636\u0627\u0641\u062A\u0647\u0627 \u0625\u0644\u0649 \u0623\u0644\u0628\u0648\u0645\u0643 \u0627\u0644\u0634\u062E\u0635\u064A (\u0628\u062D\u062F \u0623\u0642\u0635\u0649 5MB)"),r(),n(26,"div",18)(27,"div",19)(28,"label",20),c(29,"i",21),a(30," \u0627\u062E\u062A\u0631 \u0635\u0648\u0631\u0629 "),r(),n(31,"input",22,1),m("change",function(d){return p(o),g(t.onFileSelected(d))}),r(),n(33,"span",23),a(34),r()(),n(35,"button",24),m("click",function(){return p(o),g(t.uploadFile())}),c(36,"i",14),a(37),r()()(),n(38,"div",25)(39,"h4",6),c(40,"i",26),a(41," \u0635\u0648\u0631\u0643 \u0627\u0644\u062D\u0627\u0644\u064A\u0629 "),n(42,"span",27),a(43),r()(),_(44,ie,4,0,"div",28)(45,se,2,1,"div",29)(46,ae,6,0,"div",30),r()()}if(e&2){let o=I(10);s(14),E("ngModel",t.newUserName),s(2),y("\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u062D\u0627\u0644\u064A: ",t.currentUserName),s(),l("disabled",!o.valid||t.isSaving()||t.newUserName===t.currentUserName),s(),M("fa-save",!t.isSaving())("fa-spinner",t.isSaving())("fa-spin",t.isSaving()),s(),y(" ",t.isSaving()?"\u062C\u0627\u0631\u064A \u0627\u0644\u062D\u0641\u0638...":"\u062D\u0641\u0638 \u0627\u0644\u062A\u063A\u064A\u064A\u0631\u0627\u062A"," "),s(15),P(t.selectedFileName),s(),l("disabled",!t.selectedFile||t.isUploading()),s(),M("fa-upload",!t.isUploading())("fa-spinner",t.isUploading())("fa-spin",t.isUploading()),s(),y(" ",t.isUploading()?"\u062C\u0627\u0631\u064A \u0627\u0644\u0631\u0641\u0639...":"\u0631\u0641\u0639 \u0627\u0644\u0635\u0648\u0631\u0629"," "),s(6),P(t.currentImages.length),s(),l("ngIf",t.isLoadingImages()),s(),l("ngIf",!t.isLoadingImages()),s(),l("ngIf",!t.isLoadingImages()&&t.currentImages.length===0)}},dependencies:[L,T,z,K,Y,B,q,Q,$,H,J,G,W],styles:['@charset "UTF-8";.profile-edit-container[_ngcontent-%COMP%]{padding:30px;direction:rtl}.edit-title[_ngcontent-%COMP%]{color:#00bcd4;font-size:28px;margin-bottom:5px;font-weight:700}.edit-subtitle[_ngcontent-%COMP%]{color:#9e9e9e;font-size:16px;margin-bottom:30px;border-bottom:1px solid #333;padding-bottom:15px}.card-section[_ngcontent-%COMP%]{background-color:#2c2c2c;padding:25px;border-radius:8px;margin-bottom:25px;box-shadow:0 4px 15px #0000004d}.card-section[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:#e0e0e0;font-size:22px;margin-bottom:15px;border-bottom:2px solid #00bcd4;display:inline-block;padding-bottom:5px}.card-section[_ngcontent-%COMP%]   .card-text[_ngcontent-%COMP%]{color:#9e9e9e;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-label[_ngcontent-%COMP%]{display:block;color:#9e9e9e;margin-bottom:8px;font-weight:500}.form-input[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:1px solid #444;border-radius:4px;background-color:#383838;color:#e0e0e0;font-size:16px;transition:border-color .3s,box-shadow .3s}.form-input[_ngcontent-%COMP%]:focus{border-color:#00bcd4;box-shadow:0 0 0 2px #00bcd44d;outline:none}.btn-save[_ngcontent-%COMP%], .btn-upload-photos[_ngcontent-%COMP%]{background-color:#00bcd4;color:#000;padding:12px 25px;border:none;border-radius:25px;font-weight:700;cursor:pointer;transition:background-color .3s,transform .2s;font-size:16px;margin-top:10px}.btn-save[_ngcontent-%COMP%]:hover, .btn-upload-photos[_ngcontent-%COMP%]:hover{background-color:#00bcd4;transform:translateY(-2px)}.btn-save[_ngcontent-%COMP%]:disabled, .btn-upload-photos[_ngcontent-%COMP%]:disabled{background-color:#555;cursor:not-allowed;transform:none;color:#9e9e9e}.btn-save[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .btn-upload-photos[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{margin-inline-end:8px}.btn-set-main[_ngcontent-%COMP%]{position:absolute}.file-upload-area[_ngcontent-%COMP%]{border:2px dashed #555;padding:20px;border-radius:8px;text-align:center;margin-bottom:20px}.custom-file-upload[_ngcontent-%COMP%]{display:inline-block;background-color:#2c2c2c;color:#00bcd4;padding:12px 30px;border:2px solid #00bcd4;border-radius:25px;cursor:pointer;font-weight:700;transition:background-color .3s,transform .2s}.custom-file-upload[_ngcontent-%COMP%]:hover{background-color:#00bcd4;color:#000}.custom-file-upload[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]{margin-inline-end:10px}.selected-files-preview[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px;flex-wrap:wrap;gap:15px}.preview-count[_ngcontent-%COMP%]{background-color:#00796b;color:#e0e0e0;padding:8px 15px;border-radius:4px;font-size:14px}.btn-upload-photos[_ngcontent-%COMP%]{background-color:#00796b;padding:10px 20px;border-radius:4px}.btn-upload-photos[_ngcontent-%COMP%]:hover{background-color:#00796b}.file-names-list[_ngcontent-%COMP%]{margin-top:15px;font-size:12px;color:#9e9e9e;overflow-wrap:break-word;max-height:50px;overflow-y:auto}.photos-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;margin-top:20px}.photos-grid[_ngcontent-%COMP%]   .photo-item[_ngcontent-%COMP%]{position:relative;width:120px;height:120px;border-radius:8px;overflow:hidden;box-shadow:0 3px 10px #0006}.photos-grid[_ngcontent-%COMP%]   .photo-item[_ngcontent-%COMP%]   .album-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.photos-grid[_ngcontent-%COMP%]   .photo-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]{position:absolute;top:5px;inset-inline-end:5px;background:#0009;color:#00bcd4;border:none;border-radius:50%;width:25px;height:25px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:background .2s}.photos-grid[_ngcontent-%COMP%]   .photo-item[_ngcontent-%COMP%]   .btn-delete[_ngcontent-%COMP%]:hover{background:#000000e6;color:red}.no-photos[_ngcontent-%COMP%]{color:#9e9e9e;font-style:italic;width:100%;text-align:center;padding:15px 0}']})};export{ee as MyProfile};
