import{a as k,b as T,c as j}from"./chunk-PN4IQZMR.js";import{D as p,G as u,H as a,I as n,K as C,L as y,M as l,N as S,P as I,Q as o,R as m,S as d,X as f,Y as v,Z as O,ba as G,ea as M,fa as P,ga as E,ha as N,la as w,p as x,q as b,w as s,y as g,z as _}from"./chunk-N55FTWI5.js";function B(i,t){if(i&1){let e=C();a(0,"div",12),y("click",function(){let r=x(e).index,h=l(2);return b(h.makeMove(r))}),o(1),n()}if(i&2){let e=t.$implicit,c=t.index,r=l(2);I(r.getCellClass(c)),s(),d(" ",e===" "?"":e," ")}}function D(i,t){if(i&1&&(a(0,"p"),o(1),f(2,"date"),n()),i&2){let e=l(2);s(),d(" Completed: ",v(2,1,e.game.completedAt,"medium")," ")}}function X(i,t){if(i&1&&(a(0,"div",2)(1,"div",3)(2,"h2"),o(3),n(),a(4,"div",4)(5,"span",5),o(6),n(),a(7,"span"),o(8," vs "),n(),a(9,"span",6),o(10),n()(),a(11,"div",7),o(12),n()(),a(13,"div",8),p(14,B,2,3,"div",9),n(),a(15,"div",10)(16,"p"),o(17," You are playing as: "),a(18,"strong"),o(19),n()(),a(20,"p"),o(21),f(22,"date"),n(),p(23,D,3,4,"p",11),n()()),i&2){let e=l();s(3),d("Tic Tac Toe - Game #",e.game.id),s(3),m(e.game.playerXName||"Player X"),s(4),m(e.game.playerOName||"Player O"),s(2),m(e.getStatusMessage()),s(2),u("ngForOf",e.cells),s(5),m(e.playerName||"Spectator"),s(2),d("Created: ",v(22,8,e.game.createdAt,"medium")),s(2),u("ngIf",e.game.completedAt)}}function A(i,t){i&1&&(a(0,"div",13)(1,"p"),o(2,"Loading game data..."),n()())}var R=class i{constructor(t,e,c){this.gameService=t;this.route=e;this.cdr=c;this.hubConnection=new T().withUrl("https://localhost:5001/gameHub").withAutomaticReconnect([0,2e3,5e3,1e4]).build()}game=null;gameId=0;playerName="";cells=Array(9).fill(" ");gameStatus=k;subscriptions=[];joinedGame=!1;hubConnection;ngOnInit(){this.hubConnection.state!=="Connected"?this.hubConnection.start().then(()=>{console.log("SignalR connection established"),this.gameId=+this.route.snapshot.params.id,this.playerName=this.route.snapshot.queryParams.player||"",this.loadGame(),this.subscribeToGameUpdates()}).catch(t=>{console.error("Error starting SignalR connection:",t)}):(this.loadGame(),this.subscribeToGameUpdates())}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.gameId&&this.joinedGame&&this.gameService.leaveGame(this.gameId.toString()).catch(t=>{console.error("Error leaving game:",t)})}loadGame(){this.gameService.getGame(this.gameId).subscribe({next:t=>{(!this.game||this.game.id!==t.id)&&(console.log("Game loaded:",t),this.game=t,this.updateCells(),this.joinGame(),this.cdr.detectChanges())},error:t=>{console.error("Error loading game:",t)}})}joinGame(){this.game&&!this.joinedGame&&this.gameService.joinGame(this.gameId.toString()).then(()=>{this.joinedGame=!0,this.cdr.detectChanges()}).catch(t=>{console.error("\u274C Error joining game:",t)})}subscribeToGameUpdates(){let t=this.gameService.gameState$.subscribe({next:e=>{e&&e.id===this.gameId&&(console.log("\u{1F4E8} Game state updated:",e),this.game=e,this.updateCells(),this.cdr.detectChanges())},error:e=>{console.error("\u274C Error in game updates subscription:",e)}});this.subscriptions.push(t)}updateCells(){this.game&&(this.cells=this.game.boardState.split(""))}makeMove(t){if(!this.game||this.game.status!==0||this.cells[t]!==" ")return;if(this.playerName===""||this.playerName==="Spectator"){alert("\u0623\u0646\u062A \u0645\u062A\u0641\u0631\u062C \u0641\u0642\u0637 \u0648\u0644\u0627 \u064A\u0645\u0643\u0646\u0643 \u062A\u0646\u0641\u064A\u0630 \u0627\u0644\u062D\u0631\u0643\u0629.");return}let e={position:t,playerName:this.playerName},c=this.gameService.makeMove(this.gameId,e).subscribe({next:r=>{console.log("\u2705 Move made successfully"),this.game=r,this.updateCells(),this.cdr.detectChanges(),this.gameService.notifyMove(this.gameId.toString(),r).catch(h=>console.error("Error notifying move:",h))},error:r=>{console.error("\u274C Error making move:",r),alert("\u062E\u0637\u0623 \u0641\u064A \u062A\u0646\u0641\u064A\u0630 \u0627\u0644\u062D\u0631\u0643\u0629: "+(r.error?.message||r.statusText))}});this.subscriptions.push(c)}getStatusMessage(){if(!this.game)return"";switch(this.game.status){case 1:return`${this.game.playerXName||"\u0627\u0644\u0644\u0627\u0639\u0628 X"} \u0641\u0627\u0632!`;case 2:return`${this.game.playerOName||"\u0627\u0644\u0644\u0627\u0639\u0628 O"} \u0641\u0627\u0632!`;case 3:return"\u062A\u0639\u0627\u062F\u0644!";case 0:return`\u062F\u0648\u0631 ${this.game.isPlayerXTurn?this.game.playerXName||"\u0627\u0644\u0644\u0627\u0639\u0628 X":this.game.playerOName||"\u0627\u0644\u0644\u0627\u0639\u0628 O"}`;default:return""}}getCellClass(t){let e=this.cells[t];return e==="X"?"cell-x":e==="O"?"cell-o":""}static \u0275fac=function(e){return new(e||i)(g(j),g(w),g(G))};static \u0275cmp=_({type:i,selectors:[["app-game-board"]],decls:3,vars:2,consts:[["loading",""],["class","game-container",4,"ngIf","ngIfElse"],[1,"game-container"],[1,"game-header"],[1,"players"],[1,"player-x"],[1,"player-o"],[1,"status"],[1,"game-board"],["class","cell",3,"class","click",4,"ngFor","ngForOf"],[1,"game-info"],[4,"ngIf"],[1,"cell",3,"click"],[1,"loading-message"]],template:function(e,c){if(e&1&&p(0,X,24,11,"div",1)(1,A,3,0,"ng-template",null,0,O),e&2){let r=S(2);u("ngIf",c.game)("ngIfElse",r)}},dependencies:[N,M,P,E],styles:[".game-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px;text-align:center}.game-header[_ngcontent-%COMP%]{margin-bottom:30px}.game-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.players[_ngcontent-%COMP%]{font-size:18px;margin-bottom:10px}.player-x[_ngcontent-%COMP%]{color:#e74c3c;font-weight:700}.player-o[_ngcontent-%COMP%]{color:#3498db;font-weight:700}.status[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#2c3e50;margin-top:10px}.game-board[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,100px);grid-template-rows:repeat(3,100px);gap:5px;justify-content:center;margin:20px auto}.cell[_ngcontent-%COMP%]{background-color:#ecf0f1;border:2px solid #bdc3c7;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:700;cursor:pointer;transition:background-color .3s ease}.cell[_ngcontent-%COMP%]:hover{background-color:#d5dbdb}.cell-x[_ngcontent-%COMP%]{color:#e74c3c}.cell-o[_ngcontent-%COMP%]{color:#3498db}.game-info[_ngcontent-%COMP%]{margin-top:30px;padding:20px;background-color:#f8f9fa;border-radius:8px}.game-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;color:#6c757d}"]})};export{R as GameBoard};
