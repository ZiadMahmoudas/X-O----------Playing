import{a as Q}from"./chunk-IZGRFUEH.js";import{a as j,c as z,d as L,e as W}from"./chunk-2EPKHZCL.js";import"./chunk-2X2WE554.js";import{h as K}from"./chunk-IRDK2I2U.js";import{a as J}from"./chunk-2DFS2U5V.js";import{a as Y,c as q,h as G,p as H}from"./chunk-2GGCCMO2.js";import{a as y}from"./chunk-G5KA7DMQ.js";import{c as $}from"./chunk-D3ZEN3NJ.js";import{$ as f,$a as P,Aa as I,B as w,Bb as R,Ea as x,Jb as B,Pb as N,Qb as D,Sb as V,Ta as c,Ua as o,Va as s,Wa as l,_a as C,aa as _,ab as b,cb as h,eb as d,lb as S,nb as m,pa as v,pb as u,qb as U,ra as a,rb as M,sb as T,tb as A,u as k,ub as E,va as p,vb as F,yb as O}from"./chunk-22QBDJS3.js";var Z=n=>["./profile",n,"Message"],ee=n=>["./profile",n];function te(n,t){n&1&&(C(0),l(1,"img",24),P()),n&2&&(a(),c("src","https://res.cloudinary.com/dsqtrbbmw/image/upload/v1760612462/user_ei8llz.jpg",v))}function ne(n,t){if(n&1&&l(0,"img",25),n&2){let e=d().$implicit;c("src",F(e.profileImageUrl),v)("alt","\u0635\u0648\u0631\u0629 "+(e.userName||e.name))}}function ie(n,t){if(n&1&&(o(0,"div",11)(1,"div",12),l(2,"span",13),s(),o(3,"div",14),x(4,te,2,1,"ng-container",15)(5,ne,1,3,"ng-template",null,0,R),s(),o(7,"div",16)(8,"p",17),l(9,"i",18),u(10),o(11,"span",19),u(12),s()(),o(13,"div",16)(14,"div",20)(15,"a",21),l(16,"i",22),s(),o(17,"a",21),l(18,"i",23),s()()()()()),n&2){let e=t.$implicit,i=S(6),r=d(2);a(),m("online",r.isUserOnline(e.id))("offline",!r.isUserOnline(e.id)),a(2),m("placeholder-image",!e.profileImageUrl),a(),c("ngIf",!e.profileImageUrl)("ngIfElse",i),a(6),M(" ",e.userName||e.name||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"," "),a(),m("online-text",r.isUserOnline(e.id)),a(),M(" ",r.isUserOnline(e.id)?"\u{1F7E2} \u0645\u062A\u0635\u0644":"\u26AB \u063A\u064A\u0631 \u0645\u062A\u0635\u0644"," "),a(3),c("routerLink",O(14,Z,e.id)),a(2),c("routerLink",O(16,ee,e.id))}}function re(n,t){n&1&&(o(0,"div",26),l(1,"i",27),o(2,"p"),u(3,"\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646 \u0628\u0647\u0630\u0627 \u0627\u0644\u0627\u0633\u0645."),s()())}function ae(n,t){n&1&&(o(0,"div",26),l(1,"i",28),o(2,"p"),u(3,"\u0644\u0627 \u064A\u0648\u062C\u062F \u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646 \u062D\u0627\u0644\u064A\u0627\u064B."),s()())}function oe(n,t){if(n&1){let e=b();C(0),o(1,"a",30),h("click",function(){let r=f(e).$implicit,g=d(3);return _(g.changePage(r))}),u(2),s(),P()}if(n&2){let e=t.$implicit,i=d(3);a(),m("active",i.currentPage===e),a(),U(e)}}function se(n,t){if(n&1){let e=b();o(0,"div",29)(1,"a",30),h("click",function(){f(e);let r=d(2);return _(r.changePage(r.currentPage-1))}),u(2,"\xAB"),s(),x(3,oe,3,3,"ng-container",31),o(4,"a",30),h("click",function(){f(e);let r=d(2);return _(r.changePage(r.currentPage+1))}),u(5,"\xBB"),s()()}if(n&2){let e=d(2);a(),m("disabled",e.currentPage===1),a(2),c("ngForOf",e.pageNumbers),a(),m("disabled",e.currentPage===e.getTotalPages())}}function ce(n,t){if(n&1){let e=b();o(0,"div",3)(1,"div",4)(2,"input",5),E("ngModelChange",function(r){f(e);let g=d();return A(g.searchText,r)||(g.searchText=r),_(r)}),h("input",function(){f(e);let r=d();return _(r.applyFilters())}),s(),l(3,"i",6),s(),o(4,"div",7),x(5,ie,19,18,"div",8)(6,re,4,0,"div",9)(7,ae,4,0,"div",9),s(),x(8,se,6,5,"div",10),s()}if(n&2){let e=d();a(2),T("ngModel",e.searchText),a(3),c("ngForOf",e.pagedPeople)("ngForTrackBy",e.trackByUserId),a(),c("ngIf",e.filteredPeople.length===0&&e.users.length>0),a(),c("ngIf",e.users.length===0),a(),c("ngIf",e.getTotalPages()>1)}}function le(n,t){n&1&&(o(0,"div"),l(1,"router-outlet"),s())}var X=class n{constructor(t,e,i,r,g,de){this.router=t;this.userService=e;this.cdr=i;this.toastr=r;this.signalRService=g;this.auth=de}allPeople=[];filteredPeople=[];pagedPeople=[];searchText="";currentPage=1;itemsPerPage=5;showChatBox=!1;arr=["chatBox","profile"];loadUser(){this.userService.getAllUsers().subscribe({next:t=>{this.allPeople=t},error:t=>{console.log(t)}})}ngOnInit(){this.router.events.pipe(w(t=>t instanceof j),k(()=>this.arr.some(t=>this.router.url.includes(t)))).subscribe(t=>{this.showChatBox=t,this.cdr.markForCheck()}),this.getCurrentUserId(),this.checkForNewUsers(),this.signalRSubscription=this.signalRService.onlineUsers$.subscribe(t=>{this.onlineUserIdsMap=t,this.applyFilters(),this.cdr.detectChanges()}),this.initializeSignalR(),this.loadUser()}users=[];onlineUserIdsMap=[];currentUserId=null;signalRSubscription;trackByUserId=(t,e)=>e.id;ngOnDestroy(){this.signalRSubscription?.unsubscribe(),this.signalRService.stopConnection()}getCurrentUserId(){let t=this.auth.getAccessToken();if(t)try{let e=y(t);this.currentUserId=parseInt(e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"]||e.userId||e.sub),console.log("\u2705 Current User ID:",this.currentUserId)}catch(e){console.error("\u274C Error decoding token:",e)}}initializeSignalR(){let t=localStorage.getItem("accessToken");t?this.signalRService.startConnection(t).catch(e=>{console.error("\u274C Failed to start SignalR:",e)}):console.error("\u274C No access token found")}isUserOnline(t){return this.onlineUserIdsMap.includes(t)}checkForNewUsers(){this.userService.getAllUsers().subscribe({next:t=>{let e=[];if(Array.isArray(t))e=t;else if(t.data&&Array.isArray(t.data))e=t.data;else{console.error("\u274C Unexpected response structure:",t),this.users=[];return}this.currentUserId?this.users=e.filter(i=>i.id!==this.currentUserId&&i.role!=="Admin"):this.users=e.filter(i=>i.role!=="Admin"),console.log("\u{1F4CB} Users loaded (excluding self and Admin):",this.users.length),this.applyFilters(),this.cdr.detectChanges()},error:t=>{t.status===403?this.toastr.error("\u0644\u0627 \u062A\u0645\u0644\u0643 \u0635\u0644\u0627\u062D\u064A\u0629 \u0644\u0644\u0648\u0635\u0648\u0644 \u0625\u0644\u0649 \u0647\u0630\u0647 \u0627\u0644\u0635\u0641\u062D\u0629"):t.status===401?this.toastr.error("\u064A\u062C\u0628 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0623\u0648\u0644\u0627\u064B"):this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062C\u0644\u0628 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A")}})}applyFilters(){this.filteredPeople=this.users.filter(t=>{let e=this.searchText.toLowerCase(),i=t.userName?.toLowerCase().includes(e),r=t.name?.toLowerCase().includes(e),g=t.email?.toLowerCase().includes(e);return i||r||g}),this.currentPage=1,this.paginate()}paginate(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;this.pagedPeople=this.filteredPeople.slice(t,e)}roles(){let t="http://schemas.microsoft.com/ws/2008/06/identity/claims/role",e=this.auth.getAccessToken();if(!e||typeof e!="string"||e.trim()==="")return!1;try{return y(e)[t]==="User"}catch(i){return console.error("\u274C Error decoding token:",i),!1}}getTotalPages(){return Math.ceil(this.filteredPeople.length/this.itemsPerPage)}changePage(t){t>=1&&t<=this.getTotalPages()&&(this.currentPage=t,this.paginate())}get pageNumbers(){return Array(this.getTotalPages()).fill(0).map((t,e)=>e+1)}static \u0275fac=function(e){return new(e||n)(p(L),p(J),p(B),p(K),p(Q),p($))};static \u0275cmp=I({type:n,selectors:[["app-members"]],decls:2,vars:2,consts:[["actualImage",""],["class","user-list-container",4,"ngIf"],[4,"ngIf"],[1,"user-list-container"],[1,"search-bar"],["type","text","placeholder","search People",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"fas","fa-search","search-icon"],[1,"user-cards-grid"],["class","user-card",4,"ngFor","ngForOf","ngForTrackBy"],["class","no-results",4,"ngIf"],["class","pagination",4,"ngIf"],[1,"user-card"],[1,"status-indicator"],[1,"status-dot"],[1,"card-image"],[4,"ngIf","ngIfElse"],[1,"card-details"],[1,"card-name"],[1,"fas","fa-user","icon-navy"],[1,"status-text"],[1,"d-flex","gap-3","justify-content-center"],[1,"btn","btn-warning","mt-3",3,"routerLink"],[1,"fa-solid","fa-messages",2,"color","#743d3d"],[1,"fa-duotone","fa-thin","fa-circle-user",2,"color","#743d3d"],["alt","\u0635\u0648\u0631\u0629 \u0627\u0641\u062A\u0631\u0627\u0636\u064A\u0629",3,"src"],[3,"src","alt"],[1,"no-results"],[1,"fas","fa-search","fa-3x"],[1,"fas","fa-users","fa-3x"],[1,"pagination"],[1,"page-link",3,"click"],[4,"ngFor","ngForOf"]],template:function(e,i){e&1&&x(0,ce,9,6,"div",1)(1,le,2,0,"div",2),e&2&&(c("ngIf",!i.showChatBox),a(),c("ngIf",i.showChatBox))},dependencies:[V,N,D,H,Y,q,G,W,z],styles:[".user-list-container[_ngcontent-%COMP%]{padding:20px}.search-bar[_ngcontent-%COMP%]{position:relative;margin-bottom:30px;direction:rtl}.search-bar[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%;padding:12px 45px 12px 20px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px;transition:all .3s}.search-bar[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1e3a8a;box-shadow:0 0 0 3px #1e3a8a1a}.search-bar[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#666}.user-cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:25px;margin-bottom:30px}.user-card[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:12px;padding:20px;box-shadow:0 4px 6px #0000001a;transition:all .3s;text-align:center}.user-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 15px #00000026}.user-card[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{position:absolute;top:15px;left:15px;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ffffffe6;box-shadow:0 2px 8px #0000001a;z-index:10}.user-card[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;transition:all .3s}.user-card[_ngcontent-%COMP%]   .status-indicator.online[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#10b981;animation:_ngcontent-%COMP%_pulse-green 2s infinite;box-shadow:0 0 #10b981b3}.user-card[_ngcontent-%COMP%]   .status-indicator.offline[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#9ca3af}.user-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{margin-bottom:15px}.user-card[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid #f3f4f6}.user-card[_ngcontent-%COMP%]   .card-image.placeholder-image[_ngcontent-%COMP%]{color:#cbd5e1}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-name[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1f2937;margin-bottom:8px;display:flex;flex-direction:column;align-items:center;gap:5px}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-name[_ngcontent-%COMP%]   .icon-navy[_ngcontent-%COMP%]{margin-left:8px}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-name[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{font-size:13px;font-weight:500;padding:4px 12px;border-radius:12px;background:#f3f4f6;color:#6b7280}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-name[_ngcontent-%COMP%]   .status-text.online-text[_ngcontent-%COMP%]{background:#d1fae5;color:#059669}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-email[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin-bottom:15px}.user-card[_ngcontent-%COMP%]   .card-details[_ngcontent-%COMP%]   .card-email[_ngcontent-%COMP%]   .icon-navy[_ngcontent-%COMP%]{color:#1e3a8a;margin-left:8px}.user-card[_ngcontent-%COMP%]   .btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;transition:all .3s}.user-card[_ngcontent-%COMP%]   .btn-danger[_ngcontent-%COMP%]:hover{background:#dc2626;transform:scale(1.05)}@keyframes _ngcontent-%COMP%_pulse-green{0%{box-shadow:0 0 #10b981b3}50%{box-shadow:0 0 0 10px #10b98100}to{box-shadow:0 0 #10b98100}}.no-results[_ngcontent-%COMP%]{grid-column:1/-1;text-align:center;padding:60px 20px;color:#9ca3af}.no-results[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-bottom:20px}.no-results[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px;margin-top:30px}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{padding:8px 16px;border:1px solid #e5e7eb;border-radius:6px;cursor:pointer;transition:all .3s;background:#fff;color:#374151;text-decoration:none}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]:hover:not(.disabled):not(.active){background:#f3f4f6;border-color:#1e3a8a}.pagination[_ngcontent-%COMP%]   .page-link.active[_ngcontent-%COMP%]{background:#1e3a8a;color:#fff;border-color:#1e3a8a}.pagination[_ngcontent-%COMP%]   .page-link.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}"]})};export{X as Members};
