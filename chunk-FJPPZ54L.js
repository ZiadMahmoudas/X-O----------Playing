import{a as W,b as Y}from"./chunk-BV4IUNO5.js";import{d as D}from"./chunk-2EPKHZCL.js";import{a as V,c as j,h as F,p as A}from"./chunk-2GGCCMO2.js";import{a as I}from"./chunk-G5KA7DMQ.js";import{c as T}from"./chunk-D3ZEN3NJ.js";import{$ as d,Aa as S,Ea as N,Jb as k,Na as u,Oa as p,Ob as U,Pb as X,Qa as x,Ra as b,Sa as w,Sb as E,Ta as y,Ua as a,Va as o,Wa as L,aa as g,ab as f,cb as _,eb as c,nb as O,pb as s,qb as P,ra as l,rb as C,sb as v,tb as M,ub as G,va as h}from"./chunk-22QBDJS3.js";function B(r,e){r&1&&(a(0,"span",20),s(1,"YOU"),o())}function $(r,e){if(r&1){let t=f();a(0,"div",19),_("mousedown",function(){let i=d(t).$implicit,m=c(3);return g(m.selectUserX(i))}),s(1),u(2,B,2,0,"span",20),o()}if(r&2){let t=e.$implicit,n=c(3);l(),C(" \u{1F464} ",t," "),l(),p(t===n.currentUserName?2:-1)}}function q(r,e){if(r&1&&(a(0,"div",11),b(1,$,3,2,"div",18,x),o()),r&2){let t=c(2);l(),w(t.filteredUsersX)}}function H(r,e){r&1&&(a(0,"span",20),s(1,"YOU"),o())}function J(r,e){if(r&1){let t=f();a(0,"div",19),_("mousedown",function(){let i=d(t).$implicit,m=c(3);return g(m.selectUserO(i))}),s(1),u(2,H,2,0,"span",20),o()}if(r&2){let t=e.$implicit,n=c(3);l(),C(" \u{1F464} ",t," "),l(),p(t===n.currentUserName?2:-1)}}function K(r,e){if(r&1&&(a(0,"div",11),b(1,J,3,2,"div",18,x),o()),r&2){let t=c(2);l(),w(t.filteredUsersO)}}function Q(r,e){if(r&1){let t=f();a(0,"div",7)(1,"strong"),s(2),o(),a(3,"small"),s(4,"Create a game between any two registered players"),o()(),a(5,"div",8)(6,"label",9),s(7,"Player X:"),o(),a(8,"input",10),G("ngModelChange",function(i){d(t);let m=c();return M(m.newGame.playerXName,i)||(m.newGame.playerXName=i),g(i)}),_("input",function(){d(t);let i=c();return g(i.onPlayerXInput())})("focus",function(){d(t);let i=c();return g(i.onPlayerXInput())})("blur",function(){d(t);let i=c();return g(i.showSuggestionsX=!1)}),o(),u(9,q,3,0,"div",11),o(),a(10,"div",8)(11,"label",12),s(12,"Player O:"),o(),a(13,"input",13),G("ngModelChange",function(i){d(t);let m=c();return M(m.newGame.playerOName,i)||(m.newGame.playerOName=i),g(i)}),_("input",function(){d(t);let i=c();return g(i.onPlayerOInput())})("focus",function(){d(t);let i=c();return g(i.onPlayerOInput())})("blur",function(){d(t);let i=c();return g(i.showSuggestionsO=!1)}),o(),u(14,K,3,0,"div",11),o(),a(15,"div",14)(16,"small"),s(17,"\u{1F4A1} Select any two registered users to play. You can be one of them or just watch!"),o()(),a(18,"div",15)(19,"button",16),_("click",function(){d(t);let i=c();return g(i.createGame())}),s(20," \u2728 Create Game "),o(),a(21,"button",17),_("click",function(){d(t);let i=c();return g(i.reset())}),s(22," \u{1F504} Reset "),o()()}if(r&2){let t=c();l(2),C("\u{1F44B} Welcome, ",t.currentUserName,"!"),l(6),v("ngModel",t.newGame.playerXName),l(),p(t.showSuggestionsX&&t.filteredUsersX.length>0?9:-1),l(4),v("ngModel",t.newGame.playerOName),l(),p(t.showSuggestionsO&&t.filteredUsersO.length>0?14:-1)}}function Z(r,e){r&1&&(a(0,"div",2)(1,"p",21),s(2,"\u26A0\uFE0F You must be logged in to create a new game."),o(),a(3,"p",22),s(4,"\u{1F4A1} But you can spectate any game without logging in!"),o()())}function ee(r,e){r&1&&(a(0,"div",4),L(1,"div",23),a(2,"p"),s(3,"Loading games..."),o()())}function te(r,e){r&1&&(a(0,"div",5)(1,"p"),s(2,"\u{1F3AF} No games available yet."),o(),a(3,"p",24),s(4,"Be the first to create one!"),o()())}function ne(r,e){r&1&&(a(0,"span",30),s(1,"YOU"),o())}function ie(r,e){r&1&&(a(0,"span",30),s(1,"YOU"),o())}function oe(r,e){if(r&1){let t=f();a(0,"button",36),_("click",function(){d(t);let i=c().$implicit,m=c(2);return g(m.joinGame(i))}),s(1," \u{1F3AE} Join & Play "),o()}}function re(r,e){if(r&1){let t=f();a(0,"div",6)(1,"div",26)(2,"h4"),s(3),o(),a(4,"div",27)(5,"span",28)(6,"span",29),s(7,"\u274C"),o(),a(8,"strong"),s(9),o(),u(10,ne,2,0,"span",30),o(),a(11,"span",31),s(12,"VS"),o(),a(13,"span",28)(14,"span",29),s(15,"\u2B55"),o(),a(16,"strong"),s(17),o(),u(18,ie,2,0,"span",30),o()(),a(19,"div",32),s(20),o()(),a(21,"div",33),u(22,oe,2,0,"button",34),a(23,"button",35),_("click",function(){let i=d(t).$implicit,m=c(2);return g(m.spectateGame(i))}),s(24," \u{1F441}\uFE0F Watch "),o()()()}if(r&2){let t=e.$implicit,n=c(2);l(3),C("Game #",t.id),l(2),O("current-user",t.playerXName===n.currentUserName),l(4),P(t.playerXName||"Player X"),l(),p(t.playerXName===n.currentUserName?10:-1),l(3),O("current-user",t.playerOName===n.currentUserName),l(4),P(t.playerOName||"Player O"),l(),p(t.playerOName===n.currentUserName?18:-1),l(),y("ngClass",n.getStatusClass(t.status)),l(),C(" ",n.getStatusText(t.status)," "),l(2),p(n.isLoggedIn()&&t.status===n.gameStatus.InProgress&&n.isCurrentUserInGame(t)?22:-1)}}function ae(r,e){if(r&1&&N(0,re,25,12,"div",25),r&2){let t=c();y("ngForOf",t.games)}}var R=class r{constructor(e,t,n,i){this.gameService=e;this.router=t;this.cdr=n;this.auth=i}games=[];newGame={playerXName:"",playerOName:""};gameStatus=W;loading=!1;registeredUsers=[];filteredUsersX=[];filteredUsersO=[];showSuggestionsX=!1;showSuggestionsO=!1;currentUserName="";ngOnInit(){this.loadGames(),this.loadRegisteredUsers(),this.getCurrentUserName()}getCurrentUserName(){let e=this.auth.getAccessToken();if(e)try{let t=I(e),n=["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name","name","unique_name","sub"],i="";for(let m of n)if(t[m]){i=t[m];break}this.currentUserName=i.trim(),console.log("Current user:",this.currentUserName)}catch(t){console.error("Error decoding token:",t)}}loadGames(){this.loading=!0,this.gameService.getGames().subscribe({next:e=>{this.games=e,this.loading=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading games:",e),this.loading=!1,this.cdr.detectChanges()}})}loadRegisteredUsers(){this.gameService.getRegisteredUsers().subscribe({next:e=>{this.registeredUsers=e,console.log("Registered users loaded:",e),this.cdr.detectChanges()},error:e=>{console.error("Error loading users:",e)}})}onPlayerXInput(){let e=this.newGame.playerXName?.toLowerCase()||"";e.length>0?(this.filteredUsersX=this.registeredUsers.filter(t=>t.toLowerCase().includes(e)),this.showSuggestionsX=this.filteredUsersX.length>0):(this.filteredUsersX=this.registeredUsers,this.showSuggestionsX=this.registeredUsers.length>0),this.cdr.detectChanges()}onPlayerOInput(){let e=this.newGame.playerOName?.toLowerCase()||"";e.length>0?(this.filteredUsersO=this.registeredUsers.filter(t=>t.toLowerCase().includes(e)),this.showSuggestionsO=this.filteredUsersO.length>0):(this.filteredUsersO=this.registeredUsers,this.showSuggestionsO=this.registeredUsers.length>0),this.cdr.detectChanges()}selectUserX(e){this.newGame.playerXName=e,this.showSuggestionsX=!1,this.cdr.detectChanges()}selectUserO(e){this.newGame.playerOName=e,this.showSuggestionsO=!1,this.cdr.detectChanges()}createGame(){if(!this.isLoggedIn()){alert("\u26A0\uFE0F You must be logged in to create a game!");return}if(!this.newGame.playerXName||!this.newGame.playerOName){alert("\u26A0\uFE0F Please enter both player names!");return}if(this.newGame.playerXName.toLowerCase()===this.newGame.playerOName.toLowerCase()){alert("\u26A0\uFE0F Player X and Player O must be different users!");return}this.gameService.createGame(this.newGame).subscribe({next:e=>{console.log("\u2705 Game created:",e),this.newGame={playerXName:"",playerOName:""},this.games.unshift(e),this.cdr.detectChanges();let t=this.currentUserName.toLowerCase(),n=e.playerXName.toLowerCase()===t,i=e.playerOName.toLowerCase()===t;n||i?(console.log("\u2705 Current user is a player, joining game..."),n?this.joinGameAs(e,"X"):i&&this.joinGameAs(e,"O")):(console.log("\u{1F441}\uFE0F Current user is not a player, spectating..."),this.spectateGame(e))},error:e=>{console.error("\u274C Error creating game:",e);let t="Failed to create game. Please try again.";if(e.status===401)t="\u{1F512} You must be logged in to create a game!";else if(e.status===400||e.status===500){let n=e.error?.message||e.error;typeof n=="string"&&(t=`\u274C ${n}`)}alert(t)}})}showPlayerSelectionDialog(e){let t=this.currentUserName.toLowerCase(),n=e.playerXName.toLowerCase()===t,i=e.playerOName.toLowerCase()===t,m=`\u{1F3AE} Choose your position:

`;if(n&&i){m+=`\u274C Play as X
\u2B55 Play as O

`,m+="Note: You are both players in this game!";let z=confirm(m+`

Press OK to play as X, or Cancel to play as O`);this.joinGameAs(e,z?"X":"O")}else n?this.joinGameAs(e,"X"):i&&this.joinGameAs(e,"O")}joinGameAs(e,t){if(!e.id)return;let n=t==="O";this.gameService.joinGame(e.id.toString(),n).then(()=>{console.log(`\u2705 Navigating to game ${e.id} in PLAY mode`),this.router.navigate(["/games",e.id,"play"])}).catch(i=>{console.error("Error joining game:",i),alert("\u274C Failed to join game. Please try again!")})}reset(){this.newGame={playerXName:"",playerOName:""},this.showSuggestionsX=!1,this.showSuggestionsO=!1,this.cdr.detectChanges()}async joinGame(e){if(!this.isLoggedIn()){alert("\u26A0\uFE0F You must be logged in to join as a player!");return}if(!e.id){console.error("Invalid Game ID");return}let t=this.currentUserName.toLowerCase(),n=e.playerXName.toLowerCase()===t,i=e.playerOName.toLowerCase()===t;if(!n&&!i){alert(`\u274C You are not a player in this game!

Players:
\u274C ${e.playerXName}
\u2B55 ${e.playerOName}

\u{1F441}\uFE0F You can watch as a spectator instead.`),this.spectateGame(e);return}this.showPlayerSelectionDialog(e)}spectateGame(e){if(!e.id){console.error("Invalid Game ID");return}console.log(`\u2705 Navigating to game ${e.id} in WATCH mode`),this.router.navigate(["/games",e.id,"watch"])}getStatusText(e){switch(e){case 0:return"In Progress";case 1:return"X Wins";case 2:return"O Wins";case 3:return"Draw";default:return"Unknown"}}getStatusClass(e){switch(e){case 0:return"status-progress";case 1:return"status-x-wins";case 2:return"status-o-wins";case 3:return"status-draw";default:return""}}isCurrentUserInGame(e){let t=this.currentUserName.toLowerCase();return e.playerXName.toLowerCase()===t||e.playerOName.toLowerCase()===t}isLoggedIn(){return!!this.auth.getAccessToken()}static \u0275fac=function(t){return new(t||r)(h(Y),h(D),h(k),h(T))};static \u0275cmp=S({type:r,selectors:[["app-game-list"]],decls:14,vars:2,consts:[[1,"games-container"],[1,"create-game-section"],[1,"warning-box"],[1,"games-list"],[1,"loading-state"],[1,"empty-state"],[1,"game-card"],[1,"info-message","info-highlight"],[1,"form-group","autocomplete-wrapper"],["for","playerX"],["id","playerX","type","text","placeholder","Start typing to search...","autocomplete","off",3,"ngModelChange","input","focus","blur","ngModel"],[1,"suggestions-dropdown"],["for","playerO"],["id","playerO","type","text","placeholder","Start typing to search...","autocomplete","off",3,"ngModelChange","input","focus","blur","ngModel"],[1,"info-message"],[1,"button-group"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-secondary-outline",3,"click"],[1,"suggestion-item"],[1,"suggestion-item",3,"mousedown"],[1,"badge-you-small"],[1,"text-warning"],[1,"text-info"],[1,"spinner"],[1,"sub-text"],["class","game-card",4,"ngFor","ngForOf"],[1,"game-info"],[1,"players-line"],[1,"player-name"],[1,"symbol"],[1,"badge-you"],[1,"vs"],[1,"game-status",3,"ngClass"],[1,"game-actions"],[1,"btn","btn-join-highlighted"],[1,"btn","btn-spectate",3,"click"],[1,"btn","btn-join-highlighted",3,"click"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"h1"),s(2,"\u{1F3AE} Tic Tac Toe Games"),o(),a(3,"div",1)(4,"h3"),s(5,"Create New Game"),o(),u(6,Q,23,5)(7,Z,5,0,"div",2),o(),a(8,"div",3)(9,"h3"),s(10,"\u{1F4CB} Existing Games"),o(),u(11,ee,4,0,"div",4)(12,te,5,0,"div",5)(13,ae,1,1,"div",6),o()()),t&2&&(l(6),p(n.isLoggedIn()?6:7),l(5),p(n.loading?11:n.games.length===0?12:13))},dependencies:[A,V,j,F,E,U,X],styles:[".games-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.games-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#2c3e50}.create-game-section[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 2px 8px #0000001a;margin-bottom:2rem}.create-game-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#34495e}.info-message[_ngcontent-%COMP%]{padding:.75rem;background:#e8f4f8;border-left:4px solid #3498db;border-radius:4px;margin-bottom:1rem}.info-message[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#2c3e50;display:block}.info-message.info-highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border-left:4px solid #5a67d8;color:#fff;padding:1rem;margin-bottom:1.5rem}.info-message.info-highlight[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.1rem;display:block;margin-bottom:.25rem}.info-message.info-highlight[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ffffffe6;font-size:.9rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#2c3e50}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:2px solid #dfe6e9;border-radius:8px;font-size:1rem;transition:all .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px #3498db1a}.form-group[_ngcontent-%COMP%]   input.input-disabled[_ngcontent-%COMP%]{background:#f8f9fa;cursor:not-allowed;border-color:#e9ecef;color:#6c757d;font-weight:600}.autocomplete-wrapper[_ngcontent-%COMP%]{position:relative}.suggestions-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #dfe6e9;border-top:none;border-radius:0 0 8px 8px;max-height:200px;overflow-y:auto;z-index:1000;box-shadow:0 4px 6px #0000001a}.suggestion-item[_ngcontent-%COMP%]{padding:.75rem 1rem;cursor:pointer;transition:background .2s ease;border-bottom:1px solid #f0f0f0}.suggestion-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.suggestion-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.button-group[_ngcontent-%COMP%]{display:flex;gap:1rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease}.btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn.btn-secondary-outline[_ngcontent-%COMP%]{background:#fff;border:2px solid #dfe6e9;color:#2c3e50}.btn.btn-secondary-outline[_ngcontent-%COMP%]:hover{background:#f8f9fa}.btn.btn-join-highlighted[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;font-size:1.1rem;padding:1rem 2rem;animation:_ngcontent-%COMP%_pulse 2s infinite}.btn.btn-join-highlighted[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 6px 20px #f5576c66}.btn.btn-join[_ngcontent-%COMP%]{background:#3498db;color:#fff}.btn.btn-join[_ngcontent-%COMP%]:hover{background:#2980b9}.btn.btn-spectate[_ngcontent-%COMP%]{background:#95a5a6;color:#fff}.btn.btn-spectate[_ngcontent-%COMP%]:hover{background:#7f8c8d}@keyframes _ngcontent-%COMP%_pulse{0%,to{box-shadow:0 4px 12px #f5576c66}50%{box-shadow:0 6px 20px #f5576c99}}.warning-box[_ngcontent-%COMP%]{padding:1.5rem;background:#fff3cd;border:2px solid #ffc107;border-radius:8px;text-align:center}.warning-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0}.warning-box[_ngcontent-%COMP%]   .text-warning[_ngcontent-%COMP%]{color:#856404;font-weight:600}.warning-box[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]{color:#0c5460}.games-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#34495e}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:3rem}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;margin:0 auto 1rem;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#34495e;margin:.5rem 0}.empty-state[_ngcontent-%COMP%]   .sub-text[_ngcontent-%COMP%]{font-size:1rem;color:#7f8c8d}.game-card[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 2px 8px #0000001a;margin-bottom:1rem;transition:transform .3s ease,box-shadow .3s ease}.game-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.game-info[_ngcontent-%COMP%]{margin-bottom:1rem}.game-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:.75rem}.players-line[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}.player-name[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:#f8f9fa;border-radius:8px;transition:all .3s ease}.player-name[_ngcontent-%COMP%]   .symbol[_ngcontent-%COMP%]{font-size:1.2rem}.player-name[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2c3e50}.player-name.current-user[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;transform:scale(1.05);box-shadow:0 4px 12px #667eea4d}.player-name.current-user[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fff}.badge-you[_ngcontent-%COMP%]{background:#ffffff4d;padding:.2rem .5rem;border-radius:4px;font-size:.75rem;font-weight:700}.badge-you-small[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.15rem .4rem;border-radius:3px;font-size:.65rem;font-weight:700;margin-left:.5rem}.vs[_ngcontent-%COMP%]{font-weight:700;color:#95a5a6;font-size:1.1rem}.game-status[_ngcontent-%COMP%]{display:inline-block;padding:.5rem 1rem;border-radius:20px;font-weight:600;font-size:.9rem}.game-status.status-progress[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.game-status.status-x-wins[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.game-status.status-o-wins[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.game-status.status-draw[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.game-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap;justify-content:center}"],changeDetection:0})};export{R as GameList};
