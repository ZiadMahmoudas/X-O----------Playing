import{b as E,c as A,d as U,e as R,f as L}from"./chunk-2EPKHZCL.js";import{a as D}from"./chunk-2DFS2U5V.js";import{a as j}from"./chunk-G5KA7DMQ.js";import{c as N}from"./chunk-D3ZEN3NJ.js";import{$ as x,$a as v,Aa as C,Ea as p,Jb as S,Qb as k,Sb as w,Ta as s,Ua as o,Va as a,Wa as l,_a as O,aa as P,ab as M,cb as I,eb as g,mb as y,nb as b,pa as h,pb as c,qb as f,ra as i,rb as _,va as u,xb as m}from"./chunk-22QBDJS3.js";var T=()=>["/Member"],F=()=>["./Message"];function q(r,t){r&1&&(o(0,"div",4),l(1,"div",5),o(2,"p"),c(3,"\u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A..."),a()())}function V(r,t){if(r&1&&(o(0,"div",6),l(1,"i",7),o(2,"h3"),c(3),a(),o(4,"a",8),l(5,"i",9),c(6," \u0627\u0644\u0639\u0648\u062F\u0629 \u0644\u0644\u0623\u0639\u0636\u0627\u0621 "),a()()),r&2){let e=g();i(3),f(e.loadError),i(),s("routerLink",m(2,T))}}function B(r,t){if(r&1&&(o(0,"div",30),l(1,"i",31),o(2,"span"),c(3),a()()),r&2){let e=g(2);i(3),f(e.userEmail)}}function Y(r,t){r&1&&l(0,"i",32)}function G(r,t){r&1&&l(0,"i",33)}function H(r,t){if(r&1){let e=M();O(0),o(1,"div",10)(2,"a",11),l(3,"i",9),c(4," \u0627\u0644\u0639\u0648\u062F\u0629 \u0644\u0644\u0623\u0639\u0636\u0627\u0621 "),a(),o(5,"div",12)(6,"img",13),I("error",function(){x(e);let d=g();return P(d.profileImage="https://res.cloudinary.com/dsqtrbbmw/image/upload/v1760612462/user_ei8llz.jpg")}),a(),o(7,"div",14),l(8,"span",15),a()(),o(9,"div",16)(10,"h2",17),c(11),a(),o(12,"div",18)(13,"span",19),l(14,"i",20),c(15),a()(),p(16,B,4,1,"div",21),o(17,"div",22),p(18,Y,1,0,"i",23)(19,G,1,0,"i",24),c(20),a()()(),o(21,"div",25)(22,"div",26)(23,"a",27),l(24,"i",28),c(25," \u0627\u0644\u0631\u0633\u0627\u0626\u0644 "),a()(),o(26,"div",29),l(27,"router-outlet"),a()(),v()}if(r&2){let e=g();i(2),s("routerLink",m(19,T)),i(4),s("src",e.profileImage,h)("alt","\u0635\u0648\u0631\u0629 "+e.userName),i(),b("online",e.isOnline)("offline",!e.isOnline),s("title",e.isOnline?"\u0645\u062A\u0635\u0644 \u0627\u0644\u0622\u0646":"\u063A\u064A\u0631 \u0645\u062A\u0635\u0644"),i(4),f(e.userName),i(2),y("color",e.statusColor),i(2),_(" ",e.isOnline?"\u0645\u062A\u0635\u0644 \u0627\u0644\u0622\u0646":"\u063A\u064A\u0631 \u0645\u062A\u0635\u0644"," "),i(),s("ngIf",e.userEmail),i(),b("admin",e.userRole==="Admin"),i(),s("ngIf",e.userRole==="Admin"),i(),s("ngIf",e.userRole!=="Admin"),i(),_(" ",e.userRole==="Admin"?"\u0645\u062F\u064A\u0631":"\u0639\u0636\u0648"," "),i(3),s("routerLink",m(20,F))}}var z=class r{constructor(t,e,n,d,J){this.route=t;this.router=e;this.userService=n;this.auth=d;this.cdr=J}userId=0;userName="\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...";userEmail="";userRole="User";profileImage="https://res.cloudinary.com/dsqtrbbmw/image/upload/v1760612462/user_ei8llz.jpg";userStatus="Offline";lastSeen=null;currentUserId=0;isLoading=!0;loadError="";isOwnProfile=!1;routeSubscription;userSubscription;ngOnInit(){console.log("\u{1F680} Profile Component initialized"),this.currentUserId=this.getCurrentUserId(),console.log("\u{1F464} Current User ID:",this.currentUserId),this.routeSubscription=this.route.params.subscribe(t=>{let e=t.id,n=Number(e);console.log("\u{1F504} Route params changed:",{userIdParam:e,idAsNumber:n}),e&&!isNaN(n)&&n>0?(this.userId=n,this.isOwnProfile=this.userId===this.currentUserId,console.log("\u{1F4CC} Loading profile for:",{userId:this.userId,isOwnProfile:this.isOwnProfile}),this.loadUserProfileFromAPI(n)):(console.error("\u274C Invalid user ID"),this.loadError="\u0644\u0645 \u064A\u062A\u0645 \u062A\u0648\u0641\u064A\u0631 \u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0635\u062D\u064A\u062D",this.isLoading=!1)})}ngOnDestroy(){console.log("\u{1F534} Profile Component destroyed - cleaning up"),this.routeSubscription?.unsubscribe(),this.userSubscription?.unsubscribe()}getCurrentUserId(){let t=this.auth.getAccessToken();if(!t)return console.warn("\u26A0\uFE0F No access token found"),0;try{let e=j(t),n=e.sub||e.userId||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];if(n){let d=parseInt(n)||0;return console.log("\u2705 Decoded user ID:",d),d}return console.warn("\u26A0\uFE0F User ID not found in token"),0}catch(e){return console.error("\u274C Error decoding token:",e),0}}loadUserProfileFromAPI(t){if(console.log("\u{1F504} Starting to load user profile:",t),isNaN(t)||t<=0){console.error("\u274C Invalid user ID:",t),this.loadError="\u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u063A\u064A\u0631 \u0635\u0627\u0644\u062D",this.isLoading=!1;return}this.isLoading=!0,this.loadError="",this.userSubscription&&!this.userSubscription.closed&&(console.log("\u{1F6D1} Cancelling previous subscription"),this.userSubscription.unsubscribe()),this.userSubscription=this.userService.getCurrentUserById(t).subscribe({next:e=>{console.log("\u2705 API Response received:",e);let n=e.data||e;n&&n.id?(this.updateProfileData(n),console.log("\u2705 Profile updated successfully")):(console.error("\u274C Invalid user data received"),this.loadError="\u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D\u0629"),this.isLoading=!1,this.cdr.detectChanges()},error:e=>{console.error("\u274C Error loading user profile:",e),e.status===404?this.loadError="\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F":e.status===401||e.status===403?this.loadError="\u0644\u064A\u0633 \u0644\u062F\u064A\u0643 \u0635\u0644\u0627\u062D\u064A\u0629 \u0644\u0639\u0631\u0636 \u0647\u0630\u0627 \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A":this.loadError="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A",this.isLoading=!1,this.cdr.detectChanges()}})}updateProfileData(t){console.log("\u{1F4DD} Updating profile data:",t),this.userId=t.id,this.userName=t.userName||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641",this.userEmail=t.email||"",this.userRole=t.role||"User",this.profileImage=t.profileImageUrl||"https://res.cloudinary.com/dsqtrbbmw/image/upload/v1760612462/user_ei8llz.jpg",this.userStatus=t.status||"Offline",t.lastSeen&&(this.lastSeen=new Date(t.lastSeen)),console.log("\u2705 Profile data updated:",{id:this.userId,userName:this.userName,profileImage:this.profileImage,status:this.userStatus,isOwnProfile:this.isOwnProfile})}get isOnline(){return this.userStatus==="Online"}get statusColor(){return this.isOnline?"#28a745":"#6c757d"}static \u0275fac=function(e){return new(e||r)(u(E),u(U),u(D),u(N),u(S))};static \u0275cmp=C({type:r,selectors:[["app-profile"]],decls:4,vars:3,consts:[[1,"chat-page-container"],["class","loading-overlay",4,"ngIf"],["class","error-container",4,"ngIf"],[4,"ngIf"],[1,"loading-overlay"],[1,"spinner"],[1,"error-container"],[1,"fas","fa-exclamation-circle","error-icon"],[1,"btn-back-to-members",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"profile-sidebar"],[1,"back-to-members-link",3,"routerLink"],[1,"profile-image-container"],[1,"profile-img-large",3,"error","src","alt"],[1,"status-badge",3,"title"],[1,"status-dot"],[1,"profile-details-sidebar"],[1,"username-sidebar"],[1,"user-status"],[1,"status-text"],[1,"fas","fa-circle","status-icon"],["class","user-info-item",4,"ngIf"],[1,"role-badge"],["class","fas fa-user-shield",4,"ngIf"],["class","fas fa-user",4,"ngIf"],[1,"chat-content-area"],[1,"tabs-navigation"],["routerLinkActive","active",1,"tab-item",3,"routerLink"],[1,"fas","fa-comments"],[1,"main-content-outlet"],[1,"user-info-item"],[1,"fas","fa-envelope"],[1,"fas","fa-user-shield"],[1,"fas","fa-user"]],template:function(e,n){e&1&&(o(0,"div",0),p(1,q,4,0,"div",1)(2,V,7,3,"div",2)(3,H,28,21,"ng-container",3),a()),e&2&&(i(),s("ngIf",n.isLoading),i(),s("ngIf",!n.isLoading&&n.loadError),i(),s("ngIf",!n.isLoading&&!n.loadError))},dependencies:[R,L,A,w,k],styles:[".loading-overlay[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;color:#666}.loading-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}.loading-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#666}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;text-align:center;padding:40px}.error-container[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:64px;color:#dc3545;margin-bottom:20px}.error-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:30px}.error-container[_ngcontent-%COMP%]   .btn-back-to-members[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:#007bff;color:#fff;text-decoration:none;border-radius:8px;transition:all .3s ease}.error-container[_ngcontent-%COMP%]   .btn-back-to-members[_ngcontent-%COMP%]:hover{background:#0056b3;transform:translateY(-2px);box-shadow:0 4px 12px #007bff4d}.chat-page-container[_ngcontent-%COMP%]{display:flex;justify-content:center;background:#f8f9fa}.profile-sidebar[_ngcontent-%COMP%]{width:320px;background:#fff;border-right:1px solid #e0e0e0;padding:30px 20px;display:flex;flex-direction:column;align-items:center;box-shadow:2px 0 10px #0000000d}.profile-sidebar[_ngcontent-%COMP%]   .back-to-members-link[_ngcontent-%COMP%]{align-self:flex-start;display:flex;align-items:center;gap:8px;color:#007bff;text-decoration:none;font-weight:500;margin-bottom:30px;transition:all .3s ease}.profile-sidebar[_ngcontent-%COMP%]   .back-to-members-link[_ngcontent-%COMP%]:hover{color:#0056b3;transform:translate(-5px)}.profile-sidebar[_ngcontent-%COMP%]   .profile-image-container[_ngcontent-%COMP%]{position:relative;margin-bottom:20px}.profile-sidebar[_ngcontent-%COMP%]   .profile-image-container[_ngcontent-%COMP%]   .profile-img-large[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;border:4px solid #fff;box-shadow:0 4px 12px #00000026}.profile-sidebar[_ngcontent-%COMP%]   .profile-image-container[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;width:28px;height:28px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #0003}.profile-sidebar[_ngcontent-%COMP%]   .profile-image-container[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;background:#6c757d}.profile-sidebar[_ngcontent-%COMP%]   .profile-image-container[_ngcontent-%COMP%]   .status-badge.online[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#28a745;animation:_ngcontent-%COMP%_pulse 2s infinite}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]{text-align:center;width:100%}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .username-sidebar[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#2c3e50;margin-bottom:10px}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]{margin-bottom:20px}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:14px;font-weight:500}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:8px}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .user-info-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;color:#666;font-size:14px;margin-bottom:15px}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .user-info-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#007bff}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;background:#e9ecef;color:#495057;border-radius:20px;font-size:13px;font-weight:500;margin-top:10px}.profile-sidebar[_ngcontent-%COMP%]   .profile-details-sidebar[_ngcontent-%COMP%]   .role-badge.admin[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.chat-content-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:#fff}.chat-content-area[_ngcontent-%COMP%]   .tabs-navigation[_ngcontent-%COMP%]{display:flex;gap:0;border-bottom:2px solid #e0e0e0;background:#f8f9fa}.chat-content-area[_ngcontent-%COMP%]   .tabs-navigation[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]{flex:1;padding:16px 24px;text-align:center;color:#666;text-decoration:none;font-weight:500;border-bottom:3px solid transparent;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:8px}.chat-content-area[_ngcontent-%COMP%]   .tabs-navigation[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.chat-content-area[_ngcontent-%COMP%]   .tabs-navigation[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]:hover{background:#007bff0d;color:#007bff}.chat-content-area[_ngcontent-%COMP%]   .tabs-navigation[_ngcontent-%COMP%]   .tab-item.active[_ngcontent-%COMP%]{color:#007bff;background:#fff;border-bottom-color:#007bff}.chat-content-area[_ngcontent-%COMP%]   .main-content-outlet[_ngcontent-%COMP%]{flex:1;padding:20px}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.8}}@media (max-width: 768px){.chat-page-container[_ngcontent-%COMP%]{flex-direction:column}.profile-sidebar[_ngcontent-%COMP%]{width:100%;border-right:none;border-bottom:1px solid #e0e0e0}}"]})};export{z as Profile};
